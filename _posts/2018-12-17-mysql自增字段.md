---
layout: post
title:  "mysql自增字段"
date:   2018-12-17 19:56:48
categories: RDBMS
tags: MySQL
author: miaoqi
---

* content
{:toc} 
# Mysql中自增字段（AUTO_INCREMENT)的一些常识

* 在系统开发过程中，我们经常要用到唯一编号。使用过mysql的人都应该知道，mysql有一个定义列为自增的属性：AUTO_INCREMENT。

* 指定了AUTO_INCREMENT的列必须要建索引，不然会报错，索引可以为主键索引，当然也可以为非主键索引。**（不一定要做主键）**

	```
	mysql> create table user (id int auto_increment);
	ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key
	```

* 下面的定义把user表的主键定义为了name，而非自增的id字段

	```
	mysql> create table user (id int auto_increment,name varchar(20) primary key,key(id)); 
	Query OK, 0 rows affected (0.01 sec)
	```

## 指定了auto_increment的列

* 如果把一个NULL插入到一个AUTO_INCREMENT数据列里去，MySQL将自动生成下一个序列编号。编号从1开始，并1为基数递增。

* 当插入记录时，没有为AUTO_INCREMENT明确指定值，则等同插入NULL值。

	```
	mysql> insert into user (id,name) values (null,'test');
	Query OK, 1 row affected (0.00 sec)
	    
	mysql> select * from user;
	+----+------+
	| id | name |
	+----+------+
	|  1 | test |
	+----+------+
	1 row in set (0.00 sec)
	```

	上面语句等同于下面语句：

	```
	insert into user (name) values ('test');
	```

* 当插入记录时，如果为AUTO_INCREMENT字段明确指定了一个数值，则会出现两种情况：

	* **如果插入的值与已有的编号重复，则会出现出 错信息，因为AUTO_INCREMENT数据列的值必须是唯一的**
	* **如果插入的值大于已编号的值，则会把该插入到数据列中，并使在下一个编号将从这个新值开始递增。**

	**总结一句话就是auto_increment会从最后一次insert语句开始递增**

	* **如果在小于AUTO_INCREMENT字段上插入一个小于AUTO_INCREMENT的值, 比如当前AUTO_INCREMENT是50, 我插入一个47的值, 那再往后插入的值还是从50开始的, 并不会受之前的插入操作影响**

* 当更新AUTO_INCREMENT字段时, 根据存储引擎的不同, 会出现两种情况:

	* **对于MyISAM表，如果用UPDATE命令更新自增列，如果列值与已有的值重复，则会出错。如果大于已有值，则下一个编号从该值开始递增****
	* **对于Innodb表，update auto_increment字段，可能会导致发生报错, 如果将一个id更新为12, 当前AUTO_INCREMEN是10并不会发生变化, Innodb表继续插入记录, 当主键插入到12时会发生报错, 但只会报错一次, 跳过12之后会正常插入**

* 被delete语句删除的id值，除非sql中将id重新插入，否则前面空余的id不会复用。

	* **当前AUTO_INCREMENT=30, delete掉id为10的记录, 下一次插入会是31, 并不会复用空余的10**

* truncate table user 该语句会引起auto_increment的变化，从头开始。
* 修改AUTO_INCREMENT字段的起始值
	* **可用alter table table_name AUTO_INCREMENT=n命令来重设自增的起始值。**
	* **但是如果设置的n比目前的数值小的话，执行的sql不会报错，但是不会生效！MyISAM和Innodb均是如此。**