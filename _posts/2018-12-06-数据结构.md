---
layout: post
title:  "数据结构"
date:   2018-12-06 17:07:39
categories: DataStructure
tags: Liner
author: miaoqi
---

* content
{:toc}
## 微服务系统的最大挑战

### 数据一致性问题

* 数据的并发访问, 修改
* 不同请求之间的数据隔离
* 多个服务共同完成一个业务请求, 保证都完成或都失败
* 发生异常时的数据回滚

### 单服务系统如何解决这些问题?

- 数据的并发访问, 修改 - **事物**
- 不同请求之间的数据隔离 - **事物**
- 多个服务共同完成一个业务请求, 保证都完成或都失败 - **事物**
- 发生异常时的数据回滚 - **事物**

## 事物

* 事物以一种**可靠**, **一致**的方式, 访问和操作**数据库**中数据的**程序单元**

### 事物的原则

* A 原子性
* C 一致性
* I 隔离性
* D 持久性

### 数据库事物

```
BEGIN TRANSACTION;
UPDATE t_user SET amount = amount - 100 WHERE username = 'BatMan';
UPDATE t_user set amount = amount + 100 WHERE username = 'SupserMan';
COMMIT;
-- ROLLBACK 
```

### JDBC事物管理

```
// 获取连接
Connection conn = getConnection();
// 关闭自动提交
conn.setAutoCommit(false);
Statement stmt1 = conn.prepareStatement(updateUser1SQL);
stmt1.executeUpdate();
Statement stmt2 = conn.prepareStatement(updateUser2SQL);
stmt2.executeUpdate();
conn.commit(); // or conn.rollback();
```













