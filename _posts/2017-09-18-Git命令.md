---
layout: post
title:  "Git命令"
date:   2017-09-18 10:08:50
categories: VersionControl
tags: Git
author: miaoqi
---

[TOC]



# 克隆仓库

克隆所有分支

```
git clone [remote_repo]
```

克隆指定分支

```
git clone -b [branch] [remote_repo]
```

# 提交

提交代码

```
git commit -m "xxx"
```

修改未push的注释

```
git commit --amend
```

修改已push的注释

1. 首先执行命令查看最近的提交：

	```
	git rebase -i head~3 #显示最新的三次提交
	```

	结果如下：

	```
	pick 4ba8742 add:新增spring依赖注入方式
	pick ba88dea update:spring依赖注入方式格式修改
	pick f7fda7a update:Spring依赖注入的方式内容补充
	```

2. 要修改哪一行注释，就把那行的pick改成edit，然后保存退出
	这时候会提示：

	```
	Stopped at da0cccdef784e4b7f5809ce4a28743d3ff235eaa... update:spring依赖注入方式格式修改
	
	You can amend the commit now, with
	
	    git commit --amend
	
	Once you are satisfied with your changes, run
	
	    git rebase --continue
	```

	提示的内容是说:
	如果修改注释就执行git commit --amend
	如果对现状满意，就git rebase --continue 

	```
	在执行git commit --amend修改注释后，普通push失败，需要强制push
	
	    git push -f origin HEAD:master
	
	强制push之后，执行git status命令，出现提示
	
	    interactive rebase in progress; onto 18bb6af
	    Last commands done (2 commands done):
	       pick 4ba8742 add:新增spring依赖注入方式
	       edit da0cccd update:spring依赖注入方式格式修改
	    Next command to do (1 remaining command):
	       pick b717dc1 update:Spring依赖注入的方式内容补充
	      (use "git rebase --edit-todo" to view and edit)
	    You are currently editing a commit while rebasing branch 'master' on '18bb6af'.
	      (use "git commit --amend" to amend the current commit)
	      (use "git rebase --continue" once you are satisfied with your changes)
	
	如果对修改注释已经满意，即可执行continue命令回到master分支
	
	    git rebase --continue
	```

# 推送

完整命令, 将本地的dev分支推送到远端origin的dev分支

```
git push origin dev:dev
```

省略远程分支, 表示将本地分支推送到与之存在追踪关系的远程分支(通常两者同名), 如果该远程分支不存在, 则会被新建

```
git push origin dev
```

省略本地分支, 代表删除远程分支, 如果第一个分支名是空的, 代表删除远程分支

```
git push origin :dev
等同于
git push origin --delete dev
```

本地和远程分支都省略, 如果当前分支与远程分支存在追踪关系，则本地分支和远程分支都可以省略**，将当前分支推送到origin主机的对应分支

```
git push origin
```

如果当前分支只有一个远程分支，那么主机名都可以省略，形如 git push，可以使用git branch -r ，查看远程的分支名

```
git push
```

**如果当前分支和多个主机之间存在追踪关系，可以使用这个命令来设置一个默认的主机**

```
git push -u origin master
表示将当前所在分支与origin主机的master分支关联
```

# 撤销

撤销工作区修改

```
git checkout [file]
```

而不是撤销指定版本号及以后的提交

```
git reset --hard [版本号]
```

# revert

**当讨论 revert 时，需要分两种情况，因为 commit 分为两种：一种是常规的 commit，也就是使用 `git commit` 提交的 commit；另一种是 merge commit，在使用 `git merge` 合并两个分支之后，你将会得到一个新的 merge commit**

**撤销 commit**, 只撤销指定版本号的提交，**而不是撤销指定版本号及以后的提交, 这与 git reset --hard 不同**

比如： 
前天提交A 
昨天提交B 
今天提交C 
使用 git revert B 命令，只回退B提交，而不会回退C提交

```
git revert [版本号]
git push
```
**撤销 merge commit**

merge commit 和普通 commit 的不同之处在于 merge commit 包含两个 parent commit，代表该 merge commit 是从哪两个 commit 合并过来的

使用 `git show`或`git log` 命令可以查看 commit 的信息



# 清除

在编译git库拉下来的代码时，往往会产生一些中间文件，这些文件我们根本不需要, 这些文件都是Untracked files, 需要我们清除

删除 untracked files

```
git clean -f
```

连 untracked 的目录也一起删掉

```
git clean -fd
```

连 gitignore 的untrack 文件/目录也一起删掉 （慎用，一般这个是用来删掉编译出来的 .o之类的文件用的）

```
git clean -xfd
```

**在用上述 git clean 前，强烈建议加上 -n 参数来先看看会删掉哪些文件，防止重要文件被误删**

```
git clean -nf
git clean -nfd
git clean -nxfd
```



# cherry-pick

如果某提交被错误覆盖、删除或者回退，可以使用cherry-pick命令重新提交

```
git cherry-pick [版本号]
# 若有冲突，手动解决冲突后
git cherry-pick --continue 
# 冲突解决完毕后
git push
# 若因为各种原因找回失败，需要取消
git cherry-pick --abort
```

# Fork

Fork的项目要保持和主库同步，可使用如下命令：  

```
git remote add [<options>] <name> <url>

git remote add test path
git fetch test
git merge test/master
```
若不小心 remote add 了错误路径，可使用如下命令：

```
# 修改
git remote test set-url URL
# 删除
git remote rm test
```
# tag

查看

```
# 查看当前仓库的所有标签
git tag
# 检索标签
git tag -l 'v3.*'
# 查看标签版本信息
git show [tag name]
```
获取

```
# 获取远程tag
git fetch origin tag [tag name]
```

创建

```
git tag [tag name]
git tag -a [tag name] -m [说明]
# 给某个版本打标签
git tag -a [tag name] [版本号]
```
切换

```
git checkout [tag name]
```

删除

```
# 删除本地tag
git tag -d [tag name]
# 推送空tag到远程，相当于删除远程tag
git push origin :refs/tags/[tag name]
# 直接删除远程tag
git push origin --delete tag [tag name]
```
删除远端所有tag，慎用

```
git show-ref --tag | awk '/(.*)(s+)(.*)$/ {print ":" $2}' | xargs git push origin
```

删除本地所有 v1.1.0.x 的tag

```
git tag | grep "v1.1.0.d$" | xargs git tag -d
```

推送

```
# 推送指定标签
git push origin [tag name]
# 推送所有标签
git push --tags
```
# branch

查看

```
# 查看远程分支
git branch -a
# 查看远程分支状态
git remote show origin
```
切换

```
git checkout [branchName]
```

删除

```
# 删除远程分支
git push origin --delete [branchName]
# 推送空分支到远程，相当于删除远程分支
git push origin :[branchName]
# 删除不存在对应远程分支的本地分支
git remote prune origin
# 同上
git fetch -p
```
# 合并

将release分支合并到当前分支

```
git merge release
```

# stash

stash 命令可以将未提交的内容暂存的内存中, 方便切换分支

```
# 暂存当前修改
git stash
# 弹出第1个修改
git stash pop 
# 弹出第2个
git stash apply stash@{1}
# 删除一个
git stash drop id
# 删除所有
git stash clear
```
# alias

别名, 修改用户目录下的.gitconfig文件, 提高效率
添加如下配置:

```
[alias]
    g = git
    a = add
    co = checkout
    cob = checkout -b
    cmm = commit -m
    cma = commit --amend
    st = status
    pl = pull
    plp = pull -p
    ps = push
    psod = push origin --delete
    df = diff
    l = log
    ls = log --stat
    b = branch
    ba = branch -a
    bd = branch -d
    bD = branch -D
    rh = reset --hard
    t = tag
    s = stash
    sp = stash pop
    sl = stash list
    m = merge
```
# reset

若误删本地提交或者分支

```
# 查看提交记录
git reflog
# 恢复到commit号为 id 的提交，亦可使用HEAD@{1}
git reset id –hard
```
# log

查看提交记录

```
git log
```

查看指定文件历史版本

```
git log --pretty = oneline [file]
```

# show

查看指定版本的修改内容

```
git show [版本号]
```

# remote

修改本地项目指向位置, 在git服务端发生迁移操作时, 本地可以使用这条命令修改仓库的指向位置

```
git remote set-url origin git@192.168.10.4:group/repository.git
```

查看远端名称

```
git remote -v
```

这里特别说明一下, 当我们git clone一个仓库时, git默认会为我们创建一个远端代码仓库的origin, 这个origin实际上就是远程仓库的一个别名

增加远端名称, 可以增加一个名称为upstream的别名指向https://github.com/user1/repository.git

```
git remote add upstream https://github.com/user1/repository.git
```

删除远端别名

```
git remote remove origin
```


# 迁移

从原地址克隆一份裸版本库到本地，比如原本托管于 GitHub

```
git clone --bare git://github.com/username/project.git
```

然后到新的 Git 服务器上创建一个新项目，比如 GitCafe。

以镜像推送的方式上传代码到 GitCafe 服务器上

```
cd project.git
git push --mirror git@gitcafe.com/username/newproject.git
```
删除本地代码

```
cd ..
rm -rf project.git
```
到新服务器 GitCafe 上找到 Clone 地址，直接 Clone 到本地就可以了

```
git clone git@gitcafe.com/username/newproject.git
```

# 第一次推送本地仓库到远程

1. 首先将要推送到远端的目录变成本地库, 通过 git init 方法将一个普通目录变为git仓库
1. 通过命令 git add . 将目录下的内容添加到暂存区
1. 通过 git commit -m "" 将暂存区内容提交到本地仓库, 到此为止说明白本地项目已经被git管理起来了, 接下来就是推送到远程仓库
1. 登录自己的 github 账户, 创建一个新的仓库复制仓库地址
1. 使用命令  git remote add origin 仓库地址 关联本地和远程仓库
1. 使用 git push -u origin master 将本地的master分支推送到origin主机, 同时 -u 指定origin为默认主机, 以后就可以直接使用 git push 了






























