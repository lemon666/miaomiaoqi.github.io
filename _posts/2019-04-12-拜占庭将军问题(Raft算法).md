---
layout: post
title:  "拜占庭将军问题(Raft算法)"
date:   2019-04-12 09:40:27
categories: Algorithm
tags: Consistency
author: miaoqi
---

* content
{:toc}
# 什么是拜占庭将军问题

拜占庭将军问题是由计算机科学家 Leslie Lamport 所提出的有关网络通信中一致性的问题, 他为该问题做了一个有趣的比喻:

在很久很久以前，拜占庭是东罗马帝国的首都。那个时候罗马帝国国土辽阔，为了防御目的，因此每个军队都分隔很远，将军与将军之间只能靠信使传递消息。

在打仗的时候，拜占庭军队内所有将军必需达成**一致的共识**，才能更好地赢得胜利。但是，在军队内有可能存有叛徒，扰乱将军们的决定。

这时候，在已知有成员不可靠的情况下，其余忠诚的将军需要在不受叛徒或间谍的影响下达成一致的协议。

莱斯利·兰伯特（ Leslie Lamport ）通过这个比喻，表达了计算机网络中所存在的一致性问题。这个问题被称为**拜占庭将军问题**。

# 什么是 Raft 算法

Raft 算法是一种简单易懂的共识算法。它依靠 **状态机** 和 **主从同步** 的方式，在各个节点之间实现数据的一致性。

在学习Raft算法的时候，大家需要了解Raft的两个核心要点：

1. 选取主节点

2. 主从同步数据

不难理解，使用主从同步的方式，可以让集群各个节点的数据更新以主节点为准，从而保证了一致性。那么，如何选取主节点呢？

人类的出生，离不开无数小蝌蚪之间的激烈竞争。在竞争的过程中，某个速度最快运气最好的小蝌蚪最终胜出，让我们诞生到了这个世界。

同样道理，Raft算法在选择主节点的过程中，也是通过多个节点之间的**投票竞争**。

说到这里，不得不说一下Raft算法的状态机。Raft算法为节点定义了三种角色：

1. Leader（主节点）

2. Follower（从节点）

3. Candidate（参与投票竞争的节点）

让我们来看一看选主的具体流程：

**第一步**，在最初，还没有一个主节点的时候，所有节点的身份都是Follower。每一个节点都有自己的计时器，当计时达到了超时时间（Election Timeout），该节点会转变为Candidate。

![http://www.miaomiaoqi.cn/images/algorithm/raft/raft_1.png](http://www.miaomiaoqi.cn/images/algorithm/raft/raft_1.png)