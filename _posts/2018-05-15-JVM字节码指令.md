---
layout: post
title: "JVM字节码指令"
categories: [Java]
description:
keywords:
---

* content
{:toc}

## 字节码指令

* Java虚拟机的指令由一个字节长度的, 代表着某种特定操作含义的数字, 称之为操作码, 以及跟随其后的零至多个代表此操作所需参数的操作数而构成

* 操作码的长度为1个字节, 因此最大只有256条

* 基于栈的指令集架构

* javap -verbose HelloWorld.class

## 加载和存储指令

* 加载和存储指令用于将数据在栈桢中的局部变量表和操作数栈之间来回传输

* 将局部变量表加载到操作数栈: iload lload fload dload aload

* 将一个数值从操作数栈存储到局部变量表: istore lfda

* 将一个常量加载到操作数栈: bipush sipush ldc ldc_w ldc2_w aconst_null iconst_m1 iconst

* 扩充局部变量表的访问索引指令: wide

## 运算指令

* 运算或算数指令用于对两个操作数栈上的值进行某种特定的运算, 并把运算结果存储到操作数栈顶

* 加法指令: add

* 减法指令: sub

* 乘法指令: mul

* 除法指令: div

* 取余指令: rem

* 取反指令: neg

## 类型转换指令

* 类型转换指令可以将两种不同的数值类型进行相互转换, 这些转换操作一般用于实现用户代码中的显示类型转换操作以及用来处理字节码指令集中数据类型相关指令无法与数据类型一一对应的问题

* 宽化类型处理和窄化类型处理

* i2b i2c i2s l2i...

## 对象创建于访问指令

* 创建对象实例的指令: new

* 创建数组的指令: newarray anewarray multianewarray

* 访问类字段: getfield putfield getstatic putstatic

* 把数组元素加载到操作数栈的指令: baload c s l l f d a

* 将操作数栈的值存储到数组元素: astore

* 取数组长度的指令: arraylength

* 检查实例类型的指令: instanceof checkcast

## 操作数栈管理指令

* 操作数栈指令用于直接操作操作数栈

* 将操作数栈的一个或两个元素出栈: pop pop2

* 复制栈顶一个或两个数值并将复制或双份复制值重新压入栈顶: dup dup2 dup_x1 dup_x2

* 将栈顶的两个数值替换: swap

## 控制转移指令

* 控制转移指令可以让Java虚拟机有条件或无条件的从指定的位置指令而不是控制转移指令的下一条指令继续执行程序, 可以认为控制转移指令就是在修改pc寄存器的值

* 条件分支: ifeq iflt ifle ifne ifgt ifnull ifcmple...

* 符合条件分支: tableswitch lookupswitch

* 无条件分支: goto goto_w jst jsr_w ret

## 方法调用指令

* invokevirtual指令用于调用对象的实例方法, 根据对象的是实际类型进行分派(虚方法分派), 这也是Java语言中最常见的方法分派方式

* invokeinterface指令用于调用接口方法, 它会在运行时搜索一个实现了这个接口方法的对象, 找出合适的方法进行调用

* invokespecial指令用于调用一些需要特殊处理的实例方法, 包括实例初始化, 私有方法和父类方法

* invokestatic指令用于调用类方法(static方法)

## 方法返回指令

* 方法的调用指令与类型无关, 而方法返回指令则是根据返回值的类型区分的, 包括有ireturn(当返回值是boolean, byte, char, short和int类型时使用), lreturn, freturn, dreturn和areturn, 另外还有一条return指令供声明为void的方法, 实例初始化方法, 类和接口的类初始化方法使用

## 异常处理指令

* 在程序中显示抛出异常的操作会由athrow指令实现, 除了这种情况, 还有别的异常会在其他java虚拟机指令检测到异常状况时由虚拟机自动抛出

## 同步指令

​    